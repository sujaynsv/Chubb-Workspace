import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class FundTransferServiceTest {

    private FundTransferService fundTransferService;
    private AccountServiceImpl accountService;

    @BeforeEach
    void setUp() {
        accountService = new AccountServiceImpl();
        fundTransferService = new FundTransferService(accountService);
    }

    @Test
    void testInvalidAmount() {
        String result = fundTransferService.transfer("A1", "A2", -100);
        assertEquals("FAILURE: Invalid amount", result);
    }

    @Test
    void testSameAccountTransfer() {
        String result = fundTransferService.transfer("A1", "A1", 200);
        assertEquals("FAILURE: Source and destination cannot be same", result);
    }

    @Test
    void testInsufficientFunds() {
        String result = fundTransferService.transfer("A1", "A2", 2000);
        assertEquals("FAILURE: Insufficient funds", result);
    }

    @Test
    void testDestinationAccountNotFound() {
        String result = fundTransferService.transfer("A1", "A3", 100);
        assertEquals("FAILURE: Destination account not found", result);
    }

    @Test
    void testSuccessfulTransfer() {
        String result = fundTransferService.transfer("A1", "A2", 200);
        assertEquals("SUCCESS: Transfer completed", result);
        assertEquals(800.0, accountService.getBalance("A1"));
        assertEquals(700.0, accountService.getBalance("A2"));
    }

    @Test
    void testTransactionError() {
        accountService.failNextDebit = true;
        String result = fundTransferService.transfer("A1", "A2", 100);
        assertEquals("FAILURE: Transaction error", result);
    }
}
